---
title: "NDVI"
author: "Derek Sollberger"
date: "11/5/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("raster")
library("rgdal")
library("sf")
library("tidyverse")
```

```{r}
# load data
band4 <- raster("Merced20211008/LC08_CU_002009_20211008_20211022_02_TOA_B4.tif")
band5 <- raster("Merced20211008/LC08_CU_002009_20211008_20211022_02_TOA_B5.tif")
```

```{r}
NDVI <- (band5 - band4) / (band5 + band4)
```

```{r}
NDVI_df <- NDVI %>%
  projectRaster(crs = "+proj=longlat +datum=WGS84") %>%
  as("SpatialPixelsDataFrame") %>% 
  as.data.frame()
```

```{r}
Merced_NDVI_df <- NDVI_df %>%
  filter(x > -120.55) %>%
  filter(x < -120.40) %>%
  filter(y > 37.27) %>%
  filter(y < 37.38)
```

```{r}
summary(Merced_NDVI_df$layer)
```


```{r}
Merced_NDVI_df %>%
  ggplot() +
  geom_tile(aes(x = x, y = y, fill = layer)) +
  theme(panel.background = element_blank(),
        panel.grid.minor = element_blank(),
        plot.subtitle = element_text(color = "red", hjust = 0.5),
        plot.title = element_text(color = "darkgreen", hjust = 0.5)) + 
  scale_fill_gradient(low = "red", high = "green", name = "NDVI") +
  labs(title = "Normalized Difference Vegetation Index for Merced, CA",
       subtitle = "30 Day Map Challenge Days 6 and 7: Red and Green",
       caption = "USGS LandSat8 Data",
       x = "", y = "")
```

